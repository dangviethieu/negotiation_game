{{ block title }}
    The Negotiation situation (Buyer role)
{{ endblock }}
{{ block content }}
    <p>You chose to offer a fixed to the seller</p>
    <p>How much are you prepared to offer the seller (from $0 - $100)?</p>

    <table class="table">
        <tr>
            <th>Your current proposal</th>
            <td id="my-proposal">(none)</td>
            <td>
                <input type="number" id="my_offer" min="1" max="100">
                <button type="button" onclick="sendOffer()" id="btn-offer">Make new offer</button>
            </td>
        </tr>
        <tr>
            <th>{{ other_role }} proposal</th>
            <td id="other-proposal">(none)</td>
            <td>
                <button type="button" id="btn-accept" onclick="sendAccept(this)" style="display: none">Accept</button>
                <button type="button" id="btn-reject" onclick="sendReject(this)" style="display: none">Reject</button>
            </td>
        </tr>
    </table>

    <script>
        let my_offer = document.getElementById('my_offer');
        let btnAccept = document.getElementById('btn-accept');
        let btnReject = document.getElementById('btn-reject');
        let msgOtherProposal = document.getElementById('other-proposal');
        let msgMyProposal = document.getElementById('my-proposal');
    
        let otherProposal;
    
        my_offer.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                sendOffer();
            }
        });
    
        function sendOffer() {
            if (my_offer.value < 1 || my_offer.value >= 100) {
                alert("Please enter a number between 1 and 100");
                return;
            }
            liveSend({'type': 'propose', 'amount': my_offer.value})
            my_offer.value = '';
        }
    
        function sendAccept() {
            liveSend({'type': 'accept', 'amount': otherProposal})
        }

        function sendReject() {
            liveSend({'type': 'reject', 'amount': otherProposal})
        }
    
        function cu(amount) {
            return `${amount} points`;
        }
    
        function liveRecv(data) {
            console.log(data);
            if ('proposals' in data) {
                for (let [id_in_group, proposal] of data.proposals) {
    
                    if (id_in_group === js_vars.my_id) {
                        msgMyProposal.innerHTML = proposal + "$";
                    } else {
                        msgOtherProposal.innerHTML = proposal + "$";
                        otherProposal = proposal;
                        btnAccept.style.display = 'block';
                        btnReject.style.display = 'block';
                    }
                }
            }
            if ('finished' in data) {
                document.getElementById('form').submit();
            }
        }
    
        window.addEventListener('DOMContentLoaded', (event) => {
            liveSend({});
        });
    
    </script>

{{ endblock }}
